const VERSION="v0.3.0",titleVersionNumber=document.getElementById("title-version-number"),darkTheme=document.getElementById("darkStyle"),navBtn1=document.getElementById("btn-alert"),updateTime=document.querySelector("#body > nav > div > span:nth-child(5) > span"),marquee=document.getElementById("marquee"),marquee2=document.getElementById("marquee2"),DAX={value:document.querySelector("#dax > div.value > span:nth-child(2)"),change:document.querySelector("#change"),changeIcon:document.querySelector("#arrow"),
changeClass:document.querySelector("#dax > div.change-block")},SP500={value:document.querySelector("#sp500 > div.value > span:nth-child(2)"),change:document.querySelector("#sp500 > div.change-block > span:nth-child(2)"),changeIcon:document.querySelector("#sp500 > div.change-block > span.material-symbols-outlined.change-arrow"),changeClass:document.querySelector("#sp500 > div.change-block")},FTSE100={value:document.querySelector("#ftse100 > div.value > span:nth-child(2)"),change:document.querySelector("#ftse100 > div.change-block > span:nth-child(2)"),
changeIcon:document.querySelector("#ftse100 > div.change-block > span.material-symbols-outlined.change-arrow"),changeClass:document.querySelector("#ftse100 > div.change-block")},NIKKEI={value:document.querySelector("#nikkei > div.value > span:nth-child(2)"),change:document.querySelector("#nikkei > div.change-block > span:nth-child(2)"),changeIcon:document.querySelector("#nikkei > div.change-block > span.material-symbols-outlined.change-arrow"),changeClass:document.querySelector("#nikkei > div.change-block")},
cryptoMktVol={value:document.querySelector("#crypto-mkt-vol > div:nth-child(2) > span.value"),change:document.querySelector("#crypto-mkt-vol > div:nth-child(3) > span:nth-child(2)"),changeIcon:document.querySelector("#crypto-mkt-vol > div:nth-child(3) > span:nth-child(1)"),changeClass:document.querySelector("#crypto-mkt-vol > div:nth-child(3)")},BtcVsEthCap={valueBtc:document.querySelector("#crypto-24h-chng > div:nth-child(2) > span:nth-child(2)"),valueEth:document.querySelector("#crypto-24h-chng > div:nth-child(3) > span:nth-child(2)")},
BTC={value:document.querySelector("#btc > div:nth-child(2) > span:nth-child(2)"),change:document.querySelector("#btc > div:nth-child(3) > span:nth-child(2)"),changeIcon:document.querySelector("#btc > div:nth-child(3) > span.material-symbols-outlined"),changeClass:document.querySelector("#btc > div:nth-child(3)")},ETH={value:document.querySelector("#eth > div:nth-child(2) > span:nth-child(2)"),change:document.querySelector("#eth > div:nth-child(3) > span:nth-child(2)"),changeIcon:document.querySelector("#eth > div:nth-child(3) > span.material-symbols-outlined"),
changeClass:document.querySelector("#eth > div:nth-child(3)")},newsArticles=document.getElementById("news-articles"),alertPlaceholder=document.getElementById("liveAlertPlaceholder");function switchSiteTheme(){darkTheme?.disabled?darkTheme.disabled=!1:!1===darkTheme?.disabled&&(darkTheme.disabled=!0)}document.getElementById("themeSlider")?.addEventListener("click",()=>{switchSiteTheme()});
const cryptoUrls=["https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=eur&include_24hr_change=true&precision=2","https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=eur&include_24hr_change=true&precision=2","https://api.coingecko.com/api/v3/global"],stockSymbols=["AMZN","AAPL","META","JPM","PEP"],stockUrls=stockSymbols.map(a=>`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${a}&apikey=${ApiKeyAlphavantage}`),newsUrl=[`https://api.nytimes.com/svc/topstories/v2/business.json?api-key=${ApiKeyNYTimes}`],
ChangeClasses=["positive","negative","neutral"];function getChangeCSSClass(a){"string"===typeof a&&(a=parseFloat(a));return 0<a?"positive":0>a?"negative":"neutral"}function getChangeIcon(a){"string"===typeof a&&(a=parseFloat(a));return 0<a?"arrow_drop_up":0>a?"arrow_drop_down":"arrow_right"}
function triggerAlert(a,d){const b=document.createElement("div");b.innerHTML=[`<div class="alert alert-${d} alert-dismissible show fade" role="alert">`,`<div>${a}</div>`,'<button id="closeAlert" type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'].join("");alertPlaceholder?.append(b);setTimeout(()=>{document.getElementById("closeAlert")?.click()},1E4)}
function putPlaceholders(a){switch(a){case "runner":marquee&&marquee2&&(marquee.innerHTML="\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n            ",marquee2.innerHTML=
"\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n                <li>____________</li>\n                <li>\u2014\u2014</li>\n            ");
break;case "indices":const d=["value","change"];[DAX,SP500,FTSE100,NIKKEI].forEach(e=>{d.forEach(c=>{e[c]&&(e[c].innerHTML='<span class="placeholder">00.00</span>')})});break;case "crypto":const b=["value","change"];[cryptoMktVol,BTC,ETH].forEach(e=>{b.forEach(c=>{e[c]&&(e[c].innerHTML='<span class="placeholder">00.00</span>')})});BtcVsEthCap.valueBtc&&BtcVsEthCap.valueEth&&(BtcVsEthCap.valueBtc.innerHTML='<span class="placeholder">00.00</span>',BtcVsEthCap.valueEth.innerHTML='<span class="placeholder">00.00</span>');
break;case "news":newsArticles&&(newsArticles.innerHTML='<p class="placeholder">Copyright (c) 2023 The New York Times Company. All Rights Reserved.</p>')}}
async function updateVersion(){let a=[],d=!1;await fetchUrls([GitBranchApiUrl]).then(b=>{a=b}).catch(b=>{triggerAlert(b,"danger");d=!0});if(!d)try{if("OK"===a[0].status){let b=a[0].branchName;titleVersionNumber.innerHTML="main"===b?VERSION:VERSION+`-${b}`}else titleVersionNumber.innerHTML=VERSION+'-<span style="color: red;">ERR</span>',console.log(a)}catch(b){console.log(b,a),triggerAlert("Couldn't fetch git branch name.","danger"),titleVersionNumber.innerHTML=VERSION}}
async function updateRunner(){let a=[],d=!1;await fetchUrls(stockUrls).then(b=>{a=b}).catch(b=>{triggerAlert(b,"danger");d=!0});if(!d)try{let b="";a.forEach(e=>{const c=roundTo(parseFloat(e["Global Quote"]["10. change percent"].slice(0,5)));b+=`<li>
<span style="color: lightgrey;">${e["Global Quote"]["01. symbol"]}</span> 
${roundTo(e["Global Quote"]["05. price"])} 
<span class="${getChangeCSSClass(c)}">${c+"%"}</span>
</li>
<li>\u2014\u2014</li>`});void 0!=marquee&&void 0!=marquee2&&(marquee.innerHTML=b,marquee2.innerHTML=b)}catch(b){console.error(b),console.log("Runner data:",a),putPlaceholders("runner"),triggerAlert("Couldn't fetch runner data.","danger")}}
async function updateIndexStats(){let a=[],d=!1;await fetchUrls([IndicesApiUrl]).then(b=>{a=b}).catch(b=>{triggerAlert(b,"danger");d=!0});if(!d)try{const b=a[0].content,e=b.DAX;DAX.value&&DAX.change&&DAX.changeIcon&&DAX.changeClass&&(DAX.value.innerHTML=e.value,DAX.change.innerHTML=e.change,DAX.changeIcon.innerHTML=getChangeIcon(e.change),DAX.changeClass.classList.remove(...ChangeClasses),DAX.changeClass.classList.add(getChangeCSSClass(e.change)));const c=b.SP500;SP500.value&&SP500.change&&SP500.changeIcon&&
SP500.changeClass&&(SP500.value.innerHTML=c.value,SP500.change.innerHTML=c.change,SP500.changeIcon.innerHTML=getChangeIcon(c.change),SP500.changeClass.classList.remove(...ChangeClasses),SP500.changeClass.classList.add(getChangeCSSClass(c.change)));const f=b.FTSE100;FTSE100.value&&FTSE100.change&&FTSE100.changeIcon&&FTSE100.changeClass&&(FTSE100.value.innerHTML=f.value,FTSE100.change.innerHTML=f.change,FTSE100.changeIcon.innerHTML=getChangeIcon(f.change),FTSE100.changeClass.classList.remove(...ChangeClasses),
FTSE100.changeClass.classList.add(getChangeCSSClass(f.change)));const g=b.N225;NIKKEI.value&&NIKKEI.change&&NIKKEI.changeIcon&&NIKKEI.changeClass&&(NIKKEI.value.innerHTML=g.value,NIKKEI.change.innerHTML=g.change,NIKKEI.changeIcon.innerHTML=getChangeIcon(g.change),NIKKEI.changeClass.classList.remove(...ChangeClasses),NIKKEI.changeClass.classList.add(getChangeCSSClass(g.change)))}catch(b){console.error(b),console.log("Indices data:",a),putPlaceholders("indices"),triggerAlert("Couldn't fetch indices.",
"danger")}}
async function updateCryptoStats(){let [a,d,b]=["","",""],e=!1;await fetchUrls(cryptoUrls).then(c=>{[a,d,b]=c}).catch(c=>{triggerAlert(c,"danger");e=!0});if(!e)try{if(cryptoMktVol.value&&cryptoMktVol.change&&cryptoMktVol.changeIcon&&cryptoMktVol.changeClass){cryptoMktVol.value.innerHTML=nFormatter(b.data.total_market_cap.eur,2);const c=roundTo(b.data.market_cap_change_percentage_24h_usd);cryptoMktVol.change.innerHTML=c;cryptoMktVol.changeIcon.innerHTML=getChangeIcon(c);cryptoMktVol.changeClass.classList.remove(...ChangeClasses);cryptoMktVol.changeClass.classList.add(getChangeCSSClass(c))}else console.log("ERROR updating cryptoMktVol element",
cryptoMktVol);BtcVsEthCap.valueBtc&&BtcVsEthCap.valueEth?(BtcVsEthCap.valueBtc.innerHTML="BTC "+roundTo(b.data.market_cap_percentage.btc),BtcVsEthCap.valueEth.innerHTML="ETH "+roundTo(b.data.market_cap_percentage.eth)):console.log("ERROR updating BtcVsEthCap element",BtcVsEthCap);if(BTC.value&&BTC.change&&BTC.changeIcon&&BTC.changeClass){BTC.value.innerHTML=a.bitcoin.eur.toLocaleString();const c=roundTo(a.bitcoin.eur_24h_change);BTC.change.innerHTML=c;BTC.changeIcon.innerHTML=getChangeIcon(c);BTC.changeClass.classList.remove(...ChangeClasses);
BTC.changeClass.classList.add(getChangeCSSClass(c))}else console.log("ERROR updating BTC element",BTC);if(ETH.value&&ETH.change&&ETH.changeIcon&&ETH.changeClass){ETH.value.innerHTML=d.ethereum.eur.toLocaleString();const c=roundTo(d.ethereum.eur_24h_change);ETH.change.innerHTML=c;ETH.changeIcon.innerHTML=getChangeIcon(c);ETH.changeClass.classList.remove(...ChangeClasses);ETH.changeClass.classList.add(getChangeCSSClass(c))}else console.log("ERROR updating ETH element",ETH)}catch(c){console.error(c),
console.log("Crypto data:",a,d,b),putPlaceholders("crypto"),triggerAlert("Couldn't fetch crypto.","danger")}}
async function updateNewsSection(){let a,d=!1;await fetchUrls(newsUrl).then(b=>{a=b}).catch(b=>{triggerAlert(b,"danger");d=!0});if(!d)try{const b=[];a[0].results.forEach(c=>{b.push(c.title)});let e="";b.forEach(c=>{e+=`<p class="news-article glasstile">${c}</p>`});newsArticles&&(newsArticles.innerHTML=e)}catch(b){console.error(b),console.log("News data:",a),putPlaceholders("news"),triggerAlert("Couldn't fetch news.","danger")}}
function updateTimestamp(a){void 0!=updateTime&&(updateTime.innerHTML=a)}
async function updateDashboard(a=!0){a&&await sleep(3E3);checkEnvVars()?(await Promise.all([updateVersion(),updateRunner(),updateIndexStats(),updateCryptoStats(),updateNewsSection()]),updateTimestamp(getTimestamp()),triggerAlert("Stats updated.","primary")):(triggerAlert(`No API keys set in ENV (AV: ${ApiKeyAlphavantage.length}, NYT: ${ApiKeyNYTimes.length})`,"danger"),console.log("ApiKeyAlphavantage",ApiKeyAlphavantage,typeof ApiKeyAlphavantage,ApiKeyAlphavantage.length),console.log("ApiKeyNYTimes",
ApiKeyNYTimes,typeof ApiKeyNYTimes,ApiKeyNYTimes.length),console.log(checkEnvVars()))}function main(){navBtn1.addEventListener("click",()=>{updateDashboard(!1)});updateDashboard();setInterval(()=>{updateDashboard()},18E5)}document.onreadystatechange=()=>{"complete"==document.readyState&&main()};async function fetchUrls(a){return await Promise.all(a.map(d=>fetch(d,{method:"GET"}).then(b=>b.json())))}
function nFormatter(a,d){const b=/\.0+$|(\.[0-9]*[1-9])0+$/,e=[{value:1,symbol:""},{value:1E3,symbol:"k"},{value:1E6,symbol:"M"},{value:1E9,symbol:"G"},{value:1E12,symbol:"T"},{value:1E15,symbol:"P"},{value:1E18,symbol:"E"}].slice().reverse().find(function(c){return a>=c.value});return e?(a/e.value).toFixed(d).replace(b,"$1")+e.symbol:"0"}function roundTo(a,d=2){"string"===typeof a&&(a=parseFloat(a));return a.toFixed(d)}
function getTimestamp(){var a=new Date;const d=a.getHours(),b=a.getMinutes();a=a.getSeconds();return`${9<d?d:"0"+d}:${9<b?b:"0"+b}:${9<a?a:"0"+a}`}const sleep=a=>new Promise(d=>setTimeout(d,a)),bootstrapStyleTypes="primary secondary success danger warning info light dark".split(" ");function checkEnvVars(){return""===ApiKeyAlphavantage&&""===ApiKeyNYTimes?!1:!0};
